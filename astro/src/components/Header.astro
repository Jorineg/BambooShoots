---
import {
  navigation,
  localeNames,
  locales,
  localizedUrl,
  t,
  type Locale,
} from "../lib/i18n";
import { urlFor } from "../lib/sanity";

interface Props {
  locale: Locale;
  settings: any;
}

const { locale, settings } = Astro.props;
const navItems = navigation[locale];
const currentPath = Astro.url.pathname;

// Check if we are on a page that should have a static "scrolled" header from the start
const isStaticHeader = currentPath
  .split("/")
  .some((segment) =>
    ["history", "galerie", "datenschutz", "impressum"].includes(segment),
  );

const navLabels: Record<string, any> = {
  "#start": settings?.labels?.navStart,
  "#programme": settings?.labels?.navPrograms,
  "#team": settings?.labels?.navTeam,
  "#spenden": settings?.labels?.navDonate,
  "/history": settings?.labels?.navHistory,
  "/galerie": settings?.labels?.navGallery,
};
---

<header
  id="main-header"
  data-base={(import.meta.env.BASE_URL || "").replace(/\/$/, "")}
  class:list={[
    "fixed top-0 left-0 right-0 z-50 transition-all duration-500 border-b border-transparent w-full",
    { scrolled: isStaticHeader, "is-static": isStaticHeader },
  ]}
>
  <div class="w-full px-6 md:px-12 lg:px-16">
    <nav
      class="flex items-center justify-between h-[var(--header-height-mobile)] md:h-[var(--header-height-desktop)]"
    >
      <!-- Logo -->
      <a href={localizedUrl("/", locale)} class="flex items-center gap-3 group">
        {
          settings?.logo ? (
            <img
              src={urlFor(settings.logo).width(48).url()}
              alt="Bamboo Shoots Logo"
              class="w-10 h-10 md:w-12 md:h-12 rounded-full group-hover:scale-105 transition-transform duration-300"
            />
          ) : (
            <div class="header-logo-box w-10 h-10 md:w-12 md:h-12 bg-primary rounded-full flex items-center justify-center text-white text-xl transition-all duration-500">
              <svg
                class="w-6 h-6 md:w-8 md:h-8"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                stroke-linecap="round"
                stroke-linejoin="round"
              >
                <path d="M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5" />
              </svg>
            </div>
          )
        }
        <span
          class="header-text text-lg md:text-xl font-heading font-extrabold text-white sm:block hidden transition-colors duration-500 tracking-tight"
        >
          {t(settings?.siteTitle, locale) || "Bamboo Shoots"}
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-8 xl:gap-10 relative nav-container">
        {
          navItems.map((item) => (
            <>
              {(item.href === "/history" || item.href === "/galerie") && (
                <div class="nav-separator w-[1px] h-3 bg-transparent self-center transition-colors duration-500 mx-[-1rem] xl:mx-[-1.25rem]" />
              )}
              <a
                href={localizedUrl(item.href, locale)}
                class="nav-link-dynamic text-white/90 hover:text-white font-medium transition-all duration-300 relative py-2"
                data-nav-id={item.href}
              >
                <span class="relative z-10 text-[10px] uppercase tracking-[0.2em] font-bold">
                  {t(navLabels[item.href], locale) || item.label}
                </span>
                <!-- Old underlines removed for the liquid one -->
              </a>
            </>
          ))
        }
        <!-- Liquid Indicator -->
        <div 
          id="nav-indicator-liquid" 
          class="absolute bottom-0 h-0.5 bg-secondary pointer-events-none opacity-0 transition-opacity duration-300"
          style="border-radius: 2px;"
        ></div>
      </div>

      <!-- Language Toggle & Donate Button -->
      <div class="flex items-center gap-2 md:gap-8">
        <!-- Language Selector -->
        <div class="relative group">
          <button
            class="lang-btn flex items-center gap-2 text-white hover:text-white transition-colors duration-300 px-3 py-1.5 rounded-full hover:bg-white/10"
            aria-label="Select language"
          >
            <svg
              class="w-4 h-4"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              stroke-linecap="round"
              stroke-linejoin="round"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <line x1="2" y1="12" x2="22" y2="12"></line>
              <path
                d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"
              ></path>
            </svg>
            <span class="text-[10px] font-bold uppercase tracking-widest"
              >{localeNames[locale]}</span
            >
          </button>

          <!-- Dropdown -->
          <div
            class="absolute right-0 top-full mt-2 py-2 bg-branding-dark rounded-xl shadow-2xl border border-white/10 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 min-w-[140px] translate-y-2 group-hover:translate-y-0"
          >
            {
              locales.map((loc) => (
                <a
                  href={localizedUrl(currentPath, loc)}
                  class={`block px-5 py-2.5 text-[10px] font-bold uppercase tracking-widest transition-all duration-300 hover:bg-white/10 ${loc === locale ? "text-secondary bg-white/5" : "text-white/60 hover:text-white"}`}
                  onclick={`localStorage.setItem('preferred-language', '${loc}')`}
                >
                  {localeNames[loc]}
                </a>
              ))
            }
          </div>
        </div>

        <!-- Donate Button -->
        <a
          href={localizedUrl("#spenden", locale)}
          class="btn-donate text-xs font-bold uppercase tracking-widest px-8 py-3 shadow-xl shadow-secondary/20"
        >
          {
            t(settings?.labels?.donateNow, locale) ||
              (locale === "de"
                ? "Spenden"
                : locale === "en"
                  ? "Donate"
                  : "បរិច្ចាគ")
          }
        </a>

        <button
          id="mobile-menu-btn"
          class="lg:hidden relative p-2 text-white transition-colors z-50 group"
          aria-label="Toggle menu"
        >
          <div class="hamburger-lines w-6 h-4.5 flex flex-col justify-between overflow-visible">
            <span class="line line1 block h-[2px] w-6 bg-current rounded-full transition-all duration-300 origin-center"></span>
            <span class="line line2 block h-[2px] w-6 bg-current rounded-full transition-all duration-300"></span>
            <span class="line line3 block h-[2px] w-6 bg-current rounded-full transition-all duration-300 origin-center"></span>
          </div>
        </button>
      </div>
    </nav>

    <!-- Mobile Navigation (Full Screen Overlay) -->
    <div
      id="mobile-menu"
      class="lg:hidden fixed inset-0 z-40 translate-x-full transition-all duration-500 ease-[cubic-bezier(0.23,1,0.32,1)] invisible"
    >
      <!-- Backdrop with blur -->
      <div class="absolute inset-0 bg-branding-dark/95 backdrop-blur-2xl"></div>
      
      <!-- Decorative background glow -->
      <div class="absolute -top-[10%] -right-[10%] w-[80%] h-[80%] bg-primary/10 blur-[120px] rounded-full"></div>
      <div class="absolute -bottom-[10%] -left-[10%] w-[80%] h-[80%] bg-secondary/5 blur-[120px] rounded-full"></div>

      <div class="relative h-full flex flex-col justify-between px-8 sm:px-12 pt-24 pb-12">
        <nav class="flex flex-col gap-3 sm:gap-4">
          {
            navItems.map((item, index) => (
              <a
                href={localizedUrl(item.href, locale)}
                class="mobile-nav-link group relative flex items-center transition-all duration-300"
                style={`transition-delay: ${index * 80 + 100}ms`}
              >
                <span class="link-number absolute left-[-2.5rem] text-[10px] font-mono text-primary/60 tracking-tighter opacity-0 -translate-x-2 transition-all duration-500 group-hover:opacity-100 group-hover:translate-x-0 hidden sm:block">
                  0{index + 1}
                </span>
                <span class="link-text text-3xl sm:text-4xl font-heading font-extrabold text-white/90 hover:text-white relative overflow-hidden transition-transform duration-300 group-hover:translate-x-2">
                  {t(navLabels[item.href], locale) || item.label}
                  <span class="absolute bottom-0 left-0 w-full h-[2px] bg-secondary translate-x-[-101%] transition-transform duration-500 ease-out group-hover:translate-x-0"></span>
                </span>
              </a>
            ))
          }
        </nav>
        
        <!-- Bottom Section in Menu -->
        <div class="space-y-6 opacity-0 translate-y-8 transition-all duration-700 delay-500 menu-footer">
          <div class="flex gap-5 items-center">
            {locales.map((loc) => (
              <a
                href={localizedUrl(currentPath, loc)}
                class={`text-[11px] font-bold uppercase tracking-[0.2em] transition-all duration-300 ${loc === locale ? "text-secondary" : "text-white/40 hover:text-white"}`}
              >
                {localeNames[loc]}
              </a>
            ))}
          </div>
          
          <div class="border-t border-white/10 pt-6 flex flex-col gap-3">
            <span class="text-[10px] uppercase tracking-[0.3em] font-bold text-white/30">Connect</span>
            <div class="flex gap-4 text-white/60 text-[11px] font-medium">
              <span class="hover:text-white cursor-pointer transition-colors">Instagram</span>
              <span class="text-white/20">•</span>
              <span class="hover:text-white cursor-pointer transition-colors">Facebook</span>
              <span class="text-white/20">•</span>
              <span class="hover:text-white cursor-pointer transition-colors">Contact</span>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</header>

<style>
  /* New Liquid Nav Styles */
  .nav-container {
    --indicator-left: 0px;
    --indicator-width: 0px;
    --indicator-scale-y: 1;
    --indicator-elastic: 1;
  }

  #nav-indicator-liquid {
    left: var(--indicator-left);
    width: var(--indicator-width);
    transform: scaleX(var(--indicator-elastic)) scaleY(var(--indicator-scale-y));
    border-radius: 99px; /* Seamless pill/circle transition */
    transition: 
      left var(--nav-speed, 0.4s) cubic-bezier(0.2, 1, 0.3, 1),
      width var(--nav-speed, 0.4s) cubic-bezier(0.2, 1, 0.3, 1),
      transform var(--nav-speed, 0.4s) cubic-bezier(0.2, 1, 0.3, 1),
      opacity 0.3s ease;
  }

  /* When the user is actively scrolling, we can speed up or bypass the transition for tighter link */
  .is-scrolling-active #nav-indicator-liquid {
    --nav-speed: 0.1s;
  }

  .nav-link-dynamic {
    @apply text-white/90 transition-colors duration-300;
  }

  /* Define custom property for mask animation - Supported in modern browsers */
  @property --mask-stop {
    syntax: "<percentage>";
    inherits: false;
    initial-value: 100%;
  }

  /* Base styles (at top) */
  #main-header {
    background-color: transparent;
    /* Removed background/backdrop from parent to use pseudo-element for masking */
  }

  /* Background layer with mask capability */
  #main-header::before {
    content: "";
    position: absolute;
    inset: 0;
    z-index: -1;
    pointer-events: none;
    transition: all 0.5s ease;

    /* Default state (hidden/transparent) */
    background-color: transparent;
    backdrop-filter: blur(0px) saturate(100%);
    border-bottom: 1px solid transparent;

    /* Mask setup for soft edge effect */
    mask-image: linear-gradient(
      to bottom,
      black var(--mask-stop),
      transparent 100%
    );
    -webkit-mask-image: linear-gradient(
      to bottom,
      black var(--mask-stop),
      transparent 100%
    );
  }

  .header-text,
  .nav-link-dynamic,
  .lang-btn,
  #mobile-menu-btn {
    color: white;
    text-shadow:
      0 1px 3px rgba(0, 0, 0, 0.3),
      0 0 20px rgba(0, 0, 0, 0.2);
  }

  .nav-link-dynamic {
    @apply text-white/90;
  }

  .lang-btn {
    @apply text-white;
  }

  .lang-btn svg {
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.4));
  }

  /* Class-based fallback for older browsers */
  /* Fixed specificity by including ID */
  #main-header.scrolled::before {
    background-color: rgba(229, 221, 210, 0.85); /* More "milky" white */
    backdrop-filter: blur(20px) saturate(160%);
    border-bottom: 1px solid rgba(0, 0, 0, 0.05);
    --mask-stop: 100%; /* Soft spread for premium look */
  }

  /* Specific styles for static pages to ensure they win over defaults */
  header.is-static::before {
    background-color: rgba(229, 221, 210, 0.85) !important;
    backdrop-filter: blur(20px) saturate(160%) !important;
    /* --mask-stop: 100% !important; */
    border-bottom: 1px solid rgba(0, 0, 0, 0.05) !important;
  }

  header.scrolled .header-text {
    @apply text-branding-dark;
    text-shadow: none;
  }

  header.scrolled .nav-link-dynamic {
    @apply text-branding-dark/80 hover:text-primary;
    text-shadow: none;
  }

  header.scrolled .lang-btn {
    @apply text-branding-dark hover:text-primary hover:bg-black/5;
    text-shadow: none;
  }

  header.scrolled .lang-btn svg {
    filter: none;
  }

  header.scrolled #mobile-menu-btn {
    @apply text-branding-dark;
  }

  header.scrolled .nav-separator {
    @apply bg-branding-dark/10;
  }

  /* Scroll-driven animations for modern browsers */
  @supports (animation-timeline: scroll()) {
    #main-header::before {
      animation: header-fade-bg linear both;
      animation-timeline: scroll(root);
      animation-range: 100px 500px;
    }

    /* Fallback/Reset for parent if needed, though ::before handles bg now */
    #main-header {
      animation: none;
    }

    .header-text,
    #main-header #mobile-menu-btn {
      animation: header-fade-text linear both;
      animation-timeline: scroll(root);
      animation-range: 100px 300px;
    }

    .nav-link-dynamic {
      animation: header-fade-link linear both;
      animation-timeline: scroll(root);
      animation-range: 0 100px;
    }

    .nav-separator {
      animation: header-fade-separator linear both;
      animation-timeline: scroll(root);
      animation-range: 100px 300px;
    }

    .lang-btn {
      animation: header-fade-lang linear both;
      animation-timeline: scroll(root);
      animation-range: 0 100px;
    }

    .lang-btn svg {
      animation: header-fade-svg linear both;
      animation-timeline: scroll(root);
      animation-range: 0 100px;
    }
  }

  @keyframes header-fade-bg {
    0% {
      background-color: transparent;
      backdrop-filter: blur(0px) saturate(100%);
      border-bottom: 1px solid transparent;
      --mask-stop: 70%; /* Very soft edge initially */
    }
    100% {
      background-color: rgba(229, 221, 210, 0.85);
      backdrop-filter: blur(20px) saturate(180%);
      border-bottom: 1px solid rgba(0, 0, 0, 0.05);
      --mask-stop: 100%;
    }
  }

  @keyframes header-fade-text {
    from {
      color: white;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }
    to {
      color: rgb(20, 83, 45);
      text-shadow: none;
    }
  }

  @keyframes header-fade-link {
    from {
      color: rgba(255, 255, 255, 0.9);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }
    to {
      color: rgba(20, 83, 45, 0.8);
      text-shadow: none;
    }
  }

  @keyframes header-fade-lang {
    from {
      color: rgba(255, 255, 255, 1);
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }
    to {
      color: rgba(20, 83, 45, 1);
      text-shadow: none;
    }
  }

  @keyframes header-fade-svg {
    from {
      filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.4));
    }
    to {
      filter: none;
    }
  }

  @keyframes header-fade-separator {
    from {
      background-color: transparent;
    }
    to {
      background-color: rgba(20, 83, 45, 0.1);
    }
  }

  /* Disable animations on static pages */
  header.is-static::before,
  header.is-static .header-text,
  header.is-static .nav-link-dynamic,
  header.is-static .lang-btn,
  header.is-static .lang-btn svg,
  header.is-static #mobile-menu-btn,
  header.is-static .nav-separator {
    animation: none !important;
  }

  /* Hamburger Animation */
  .hamburger-lines .line2 {
    margin: 4px 0;
  }

  #mobile-menu-btn.is-active {
    color: white !important; /* Ensure visibility on dark overlay */
  }

  #mobile-menu-btn.is-active .line1 {
    transform: translateY(6px) rotate(45deg);
  }

  #mobile-menu-btn.is-active .line2 {
    opacity: 0;
    transform: scaleX(0);
  }

  #mobile-menu-btn.is-active .line3 {
    transform: translateY(-6px) rotate(-45deg);
  }

  /* Mobile menu active states */
  #mobile-menu.is-open {
    @apply visible translate-x-0;
  }

  #mobile-menu.is-open .mobile-nav-link {
    @apply opacity-100 translate-y-0;
  }

  #mobile-menu.is-open .menu-footer {
    @apply opacity-100 translate-y-0 delay-[600ms];
  }

  .mobile-nav-link {
    @apply opacity-0 translate-y-8 transition-all duration-700 ease-[cubic-bezier(0.23,1,0.32,1)];
  }

  /* Prevent scrolling when menu is open */
  :global(body.menu-open) {
    overflow: hidden;
  }
</style>

<script>
  function initHeader() {
    const header = document.getElementById("main-header");
    const mobileMenuBtn = document.getElementById("mobile-menu-btn");
    const mobileMenu = document.getElementById("mobile-menu");
    const navContainer = document.querySelector(".nav-container");
    const indicator = document.getElementById("nav-indicator-liquid");
    const navLinks = document.querySelectorAll(".nav-link-dynamic");
    const base = header?.getAttribute('data-base') || '';

    // --- Basic Header Scroll Logic ---
    const handleScroll = () => {
      if (window.CSS && CSS.supports("animation-timeline", "scroll()")) {
        return;
      }
      if (header?.classList.contains("is-static")) return;
      if (window.scrollY > 50) {
        header?.classList.add("scrolled");
      } else {
        header?.classList.remove("scrolled");
      }
    };

    window.addEventListener("scroll", handleScroll, { passive: true });
    handleScroll();

    mobileMenuBtn?.addEventListener("click", () => {
      const isOpen = mobileMenu?.classList.toggle("is-open");
      mobileMenuBtn.classList.toggle("is-active");
      document.body.classList.toggle("menu-open");
      
      // Force header to stay consistent while menu is open
      if (isOpen) {
        header?.classList.add("scrolled");
      } else if (window.scrollY <= 50) {
        header?.classList.remove("scrolled");
      }
    });

    // Close menu on link click
    mobileMenu?.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        mobileMenu.classList.remove("is-open");
        mobileMenuBtn?.classList.remove("is-active");
        document.body.classList.remove("menu-open");
      });
    });

    // --- Liquid Navigation Logic ---
    const container = navContainer as HTMLElement;
    const bar = indicator as HTMLElement;
    if (!container || !bar) return;

    let isHovering = false;
    
    // Predetermine which links are anchors and what they point to
    const anchors = Array.from(navLinks).map((link, index) => {
      const id = link.getAttribute('data-nav-id');
      const target = (id?.startsWith('#') && id.length > 1) ? document.querySelector(id) : null;
      return { link, target, index };
    }).filter(item => item.target !== null);

    let lastActiveIdx = -1;

    function updateIndicator(targetEl: Element | null, liquidEffect = true, elastic = 1) {
      if (!(targetEl instanceof HTMLElement) || !container || !bar) return;
      
      const containerRect = container.getBoundingClientRect();
      const targetRect = targetEl.getBoundingClientRect();
      
      const left = targetRect.left - containerRect.left;
      const width = targetRect.width;

      container.style.setProperty('--indicator-left', `${left}px`);
      container.style.setProperty('--indicator-width', `${width}px`);
      container.style.setProperty('--indicator-elastic', elastic.toString());
      
      if (liquidEffect) {
        container.style.setProperty('--indicator-scale-y', '1.1');
      } else {
        container.style.setProperty('--indicator-scale-y', '1');
      }
      
      bar.classList.remove('opacity-0');
    }

    // Magnetic Hover
    navLinks.forEach((link) => {
      link.addEventListener('mouseenter', () => {
        isHovering = true;
        container.style.setProperty('--nav-speed', '0.4s');
        updateIndicator(link);
      });

      link.addEventListener('mouseleave', () => {
        isHovering = false;
        syncWithScroll();
      });
      
      link.addEventListener('click', () => {
        container.style.setProperty('--nav-speed', '0.6s');
      });
    });

    function syncWithScroll() {
      if (isHovering || !container || !bar) return;

      const scrollY = window.scrollY;
      const path = window.location.pathname.replace(/\/$/, ''); // Normalize: remove trailing slash
      
      // Robust home check: if we have scroll-anchors on this page, treat it as home-style scroll sync
      const isHome = anchors.length > 0;

      if (isHome) {
        let activeIdx = 0;
        let progress = 0;
        const trigger = 120; // Slightly larger trigger for better feel
        const transitionZone = 200;

        // Find the active anchor based on targets
        for (let i = 0; i < anchors.length; i++) {
          const target = anchors[i].target as HTMLElement;
          const rect = target.getBoundingClientRect();
          
          if (rect.top <= trigger) {
             activeIdx = i;
          }
        }

        // Check if we are transitioning to the NEXT anchor
        if (activeIdx < anchors.length - 1) {
          const nextTarget = anchors[activeIdx + 1].target as HTMLElement;
          const nextRect = nextTarget.getBoundingClientRect();
          
          if (nextRect.top <= trigger + transitionZone) {
            progress = 1 - (Math.max(0, nextRect.top - trigger) / transitionZone);
          }
        }

        const currentLink = anchors[activeIdx].link;
        if (progress > 0 && activeIdx < anchors.length - 1) {
          const nextLink = anchors[activeIdx + 1].link;
          
          if (currentLink instanceof HTMLElement && nextLink instanceof HTMLElement) {
            const containerRect = container.getBoundingClientRect();
            const r1 = currentLink.getBoundingClientRect();
            const r2 = nextLink.getBoundingClientRect();
            
            const x1 = r1.left - containerRect.left;
            const w1 = r1.width;
            const x2 = r2.left - containerRect.left;
            const w2 = r2.width;

            const easeProgress = progress < 0.5 
              ? 2 * progress * progress 
              : 1 - Math.pow(-2 * progress + 2, 2) / 2;

            const currentLeft = x1 + (x2 - x1) * easeProgress;
            const currentWidth = w1 + (w2 - w1) * easeProgress;
            const liquidShrink = 1 - Math.sin(progress * Math.PI) * 0.6;
            
            container.style.setProperty('--indicator-left', `${currentLeft}px`);
            container.style.setProperty('--indicator-width', `${currentWidth}px`);
            container.style.setProperty('--indicator-elastic', liquidShrink.toString());
            container.style.setProperty('--indicator-scale-y', (1 + Math.sin(progress * Math.PI) * 0.2).toString());
            container.style.setProperty('--nav-speed', '0.05s');
          }
        } else {
          container.style.setProperty('--nav-speed', '0.4s');
          updateIndicator(currentLink, false, 1);
        }
        bar.classList.remove('opacity-0');
      } else {
        // Subpage logic
        let found = false;
        navLinks.forEach(link => {
          const rawHref = link.getAttribute('href') || '';
          // Remove hash and trailing slash for matching
          const href = rawHref.split('#')[0].replace(/\/$/, '');
          
          // Match if path is exactly href, or if path starts with href (and href is not just root)
          const isMatch = href && (path === href || (href.length > base.length && path.startsWith(href)));
          
          if (isMatch) {
             updateIndicator(link, false, 1);
             found = true;
          }
        });
        if (!found) bar.classList.add('opacity-0');
      }
    }

    // Throttled scroll
    let ticking = false;
    window.addEventListener('scroll', () => {
      if (!ticking) {
        window.requestAnimationFrame(() => {
          syncWithScroll();
          ticking = false;
        });
        ticking = true;
      }
    }, { passive: true });

    // Initial syncs
    setTimeout(syncWithScroll, 100);
    setTimeout(syncWithScroll, 1000); // Back up for slow loads
    
    window.addEventListener('resize', syncWithScroll);
  }

  // Wrap in astro:page-load for ViewTransitions support
  document.addEventListener("astro:page-load", initHeader);
</script>
