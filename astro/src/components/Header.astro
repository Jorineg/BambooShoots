---
import { navigation, localeNames, locales, localizedUrl, t, type Locale } from '../lib/i18n';
import { urlFor } from '../lib/sanity';

interface Props {
  locale: Locale;
  settings: any;
}

const { locale, settings } = Astro.props;
const navItems = navigation[locale];
const currentPath = Astro.url.pathname;
---

<header class="fixed top-0 left-0 right-0 z-50 glass border-b border-earth-200">
  <div class="container-custom">
    <nav class="flex items-center justify-between h-16 md:h-20 px-4 md:px-8">
      <!-- Logo -->
      <a href="/" class="flex items-center gap-3 group">
        {settings?.logo ? (
          <img 
            src={urlFor(settings.logo).width(48).url()} 
            alt="Bamboo Shoots Logo" 
            class="w-10 h-10 md:w-12 md:h-12 rounded-full group-hover:scale-105 transition-transform"
          />
        ) : (
          <div class="w-10 h-10 md:w-12 md:h-12 bg-bamboo-500 rounded-full flex items-center justify-center text-white text-xl">
            ðŸŒ±
          </div>
        )}
        <span class="text-lg md:text-xl font-heading font-bold text-bamboo-800 hidden sm:block">
          Bamboo Shoots
        </span>
      </a>

      <!-- Desktop Navigation -->
      <div class="hidden lg:flex items-center gap-6">
        {navItems.map((item) => (
          <a 
            href={localizedUrl(item.href, locale)} 
            class="nav-link"
          >
            {item.label}
          </a>
        ))}
      </div>

      <!-- Language Toggle & Donate Button -->
      <div class="flex items-center gap-2 md:gap-4">
        <!-- Language Selector -->
        <div class="relative group">
          <button 
            class="lang-toggle"
            aria-label="Select language"
          >
            <span class="text-sm font-medium">{localeNames[locale]}</span>
            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
            </svg>
          </button>
          
          <!-- Dropdown -->
          <div class="absolute right-0 top-full mt-1 py-1 bg-white rounded-lg shadow-lg border border-earth-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-200 min-w-[120px]">
            {locales.map((loc) => (
              <a 
                href={localizedUrl(currentPath, loc)}
                class={`block px-4 py-2 text-sm hover:bg-bamboo-50 ${loc === locale ? 'text-bamboo-700 bg-bamboo-50 font-medium' : 'text-earth-700'}`}
              >
                {localeNames[loc]}
              </a>
            ))}
          </div>
        </div>

        <!-- Donate Button -->
        <a 
          href="#spenden" 
          class="btn-donate text-sm md:text-base px-4 md:px-6 py-2 md:py-3"
        >
          {locale === 'de' ? 'Spenden' : locale === 'en' ? 'Donate' : 'áž”ážšáž·áž…áŸ’áž…áž¶áž‚'}
        </a>

        <!-- Mobile Menu Button -->
        <button 
          id="mobile-menu-btn"
          class="lg:hidden p-2 text-earth-700 hover:text-bamboo-600"
          aria-label="Toggle menu"
        >
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
        </button>
      </div>
    </nav>

    <!-- Mobile Navigation -->
    <div id="mobile-menu" class="lg:hidden hidden border-t border-earth-200 bg-white">
      <div class="py-4 px-4 space-y-2">
        {navItems.map((item) => (
          <a 
            href={localizedUrl(item.href, locale)} 
            class="block py-2 px-4 text-earth-700 hover:text-bamboo-600 hover:bg-bamboo-50 rounded-lg transition-colors"
          >
            {item.label}
          </a>
        ))}
      </div>
    </div>
  </div>
</header>

<!-- Spacer for fixed header -->
<div class="h-16 md:h-20"></div>

<script>
  const mobileMenuBtn = document.getElementById('mobile-menu-btn');
  const mobileMenu = document.getElementById('mobile-menu');
  
  mobileMenuBtn?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
  });
</script>
