---
import { t, type Locale } from '../../lib/i18n';

interface Props {
  locale: Locale;
  tiers: any[];
  settings: any;
}

const { locale, tiers, settings } = Astro.props;

// Default donation tiers
const defaultTiers = [
  {
    amount: 35,
    title: { de: 'Vorschulplatz', en: 'Preschool Place', kh: 'កន្លែងមត្តេយ្យ' },
    description: { 
      de: '5x pro Woche für einen Vorschulplatz – inklusive Mahlzeit & Material',
      en: '5x per week for a preschool place – including meal & materials',
      kh: '5 ដង/សប្តាហ៍ សម្រាប់កន្លែងមត្តេយ្យ – រួមទាំងអាហារ និងសម្ភារៈ'
    }
  },
  {
    amount: 15,
    title: { de: 'Nachmittagsförderung', en: 'Afternoon Support', kh: 'ការគាំទ្រពេលរសៀល' },
    description: { 
      de: '3x pro Woche an zwei Standorten + Englisch – inklusive Mahlzeit & Material',
      en: '3x per week at two locations + English – including meal & materials',
      kh: '3 ដង/សប្តាហ៍ នៅពីរទីតាំង + អង់គ្លេស – រួមទាំងអាហារ និងសម្ភារៈ'
    }
  },
  {
    amount: null,
    title: { de: 'Krisenhilfe & Gemeindearbeit', en: 'Crisis Aid & Community Work', kh: 'ជំនួយវិបត្តិ និងការងារសហគមន៍' },
    description: { 
      de: 'Freier Betrag für beispielsweise Fahrräder, Reis- oder Hygienepakete',
      en: 'Any amount for bicycles, rice or hygiene packages',
      kh: 'ចំនួនណាមួយសម្រាប់កង់ អង្ករ ឬកញ្ចប់អនាម័យ'
    }
  }
];

const displayTiers = tiers?.length > 0 ? tiers : defaultTiers;
---

<section id="spenden" class="section bg-bamboo-900 text-white relative overflow-hidden">
  <div class="container-custom relative z-10">
    <!-- Section header -->
    <div class="text-center mb-16 md:mb-24">
      <h2 class="text-3xl md:text-5xl font-heading font-bold text-white mb-8">
        {locale === 'de' ? 'Spenden & Mitmachen' : locale === 'en' ? 'Donate & Get Involved' : 'បរិច្ចាគ និងចូលរួម'}
      </h2>
      <p class="text-bamboo-200 text-lg max-w-2xl mx-auto leading-relaxed">
        {locale === 'de' 
          ? 'Ihre Unterstützung macht den Unterschied. Spenden Sie gezielt – transparent und wirkungsvoll.'
          : locale === 'en'
          ? 'Your support makes the difference. Donate purposefully – transparently and effectively.'
          : 'ការគាំទ្ររបស់អ្នកបង្កើតភាពខុសគ្នា។ បរិច្ចាគដោយមានគោលបំណង។'}
      </p>
    </div>

    <!-- Donation tiers -->
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8 mb-20">
      {displayTiers.map((tier, index) => {
        const paypalUrl = settings?.donationLinks?.paypal && tier.amount 
          ? `${settings.donationLinks.paypal}&amount=${tier.amount}`
          : settings?.donationLinks?.paypal;

        return (
          <a 
            href={paypalUrl}
            target="_blank"
            rel="noopener noreferrer"
            class={`group relative bg-bamboo-800/40 backdrop-blur-sm rounded-2xl p-8 md:p-10 border border-bamboo-700/50 hover:border-khmer-500/50 hover:bg-bamboo-800/60 transition-all duration-500 flex flex-col h-full ${index === 0 ? 'ring-1 ring-khmer-500/30' : ''}`}
          >
            {index === 0 && (
              <div class="absolute top-6 right-6 bg-khmer-600 text-white text-[10px] uppercase tracking-widest font-bold px-3 py-1 rounded-full shadow-sm">
                {locale === 'de' ? 'Beliebt' : locale === 'en' ? 'Popular' : 'ពេញនិយម'}
              </div>
            )}
            
            <div class="text-3xl md:text-5xl font-heading font-bold mb-4 text-white group-hover:scale-105 transition-transform origin-left">
              {tier.amount ? `${tier.amount} €` : (locale === 'de' ? 'Freier Betrag' : locale === 'en' ? 'Any Amount' : 'ចំនួនណាមួយ')}
            </div>
            
            <h3 class="text-xl font-bold mb-4 text-bamboo-100">
              {t(tier.title, locale)}
            </h3>
            
            <p class="text-bamboo-200/80 text-sm leading-relaxed mb-8 flex-grow">
              {t(tier.description, locale)}
            </p>

            <div class="flex items-center gap-2 text-khmer-400 font-bold text-xs uppercase tracking-widest opacity-0 group-hover:opacity-100 transition-opacity">
              <span>{locale === 'de' ? 'Jetzt spenden' : locale === 'en' ? 'Donate now' : 'បរិច្ចាគឥឡូវ'}</span>
              <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"></path>
              </svg>
            </div>
          </a>
        );
      })}
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-12 items-stretch">
      <!-- Digital Donation -->
      <div class="bg-earth-100 rounded-3xl p-10 md:p-15 border border-earth-200 flex flex-col">
        <h3 class="text-bamboo-900 font-heading font-bold text-2xl mb-8 flex items-center gap-4">
          <svg class="w-6 h-6 text-khmer-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <circle cx="12" cy="12" r="9" stroke-width="2"></circle>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1"></path>
          </svg>
          {locale === 'de' ? 'Online spenden' : locale === 'en' ? 'Donate Online' : 'បរិច្ចាគអនឡាញ'}
        </h3>
        
        <div class="flex flex-col gap-4">
          {settings?.donationLinks?.betterplace && (
            <a 
              href={settings.donationLinks.betterplace}
              target="_blank"
              rel="noopener noreferrer"
              class="flex items-center justify-between group p-6 bg-white rounded-2xl border border-earth-200 hover:border-bamboo-300 transition-all hover:shadow-md"
            >
              <span class="text-bamboo-800 font-bold uppercase tracking-tight">betterplace.org</span>
              <svg class="w-6 h-6 text-bamboo-300 group-hover:text-bamboo-600 group-hover:translate-x-1 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
              </svg>
            </a>
          )}
          
          {settings?.donationLinks?.paypal && (
            <a 
              href={settings.donationLinks.paypal}
              target="_blank"
              rel="noopener noreferrer"
              class="flex items-center justify-between group p-6 bg-[#0070ba] text-white rounded-2xl border border-[#005ea6] hover:bg-[#005ea6] transition-all hover:shadow-lg"
            >
              <div class="flex items-center gap-2">
                <span class="font-extrabold italic text-xl">PayPal</span>
              </div>
              <svg class="w-6 h-6 text-white/50 group-hover:text-white group-hover:translate-x-1 transition-all" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3"></path>
              </svg>
            </a>
          )}
        </div>
      </div>

      <!-- Bank Transfer Details -->
      <div class="bg-bamboo-800 rounded-3xl p-10 md:p-12 border border-bamboo-700 shadow-xl">
        <h3 class="font-heading font-bold text-2xl text-white mb-8 flex items-center gap-4">
          <svg class="w-6 h-6 text-bamboo-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 10h18M7 15h1m4 0h1m-7 4h12a3 3 0 003-3V8a3 3 0 00-3-3H6a3 3 0 00-3 3v8a3 3 0 003 3z"></path>
          </svg>
          {locale === 'de' ? 'Banküberweisung' : locale === 'en' ? 'Bank Transfer' : 'ផ្ទេរប្រាក់តាមធនាគារ'}
        </h3>
        <div class="text-bamboo-100 text-sm space-y-4">
          {settings?.bankAccount?.[locale] ? (
            <div class="space-y-4">
              <div>
                <p class="text-bamboo-400 text-[10px] uppercase font-bold tracking-widest mb-1">Kontoinhaber</p>
                <p class="font-bold text-white text-lg">{settings.bankAccount[locale].name}</p>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <p class="text-bamboo-400 text-[10px] uppercase font-bold tracking-widest mb-1">Bank</p>
                  <p class="text-white">{settings.bankAccount[locale].bank}</p>
                </div>
                <div>
                  <p class="text-bamboo-400 text-[10px] uppercase font-bold tracking-widest mb-1">BIC</p>
                  <p class="text-white font-mono uppercase tracking-wider">{settings.bankAccount[locale].bic}</p>
                </div>
              </div>
              <div>
                <p class="text-bamboo-400 text-[10px] uppercase font-bold tracking-widest mb-1">IBAN</p>
                <p class="font-mono text-xl text-khmer-400 break-all">{settings.bankAccount[locale].iban}</p>
              </div>
            </div>
          ) : (
            <p class="italic text-bamboo-400 py-8">
              {locale === 'de' ? 'Bankinformationen folgen in Kürze.' : locale === 'en' ? 'Bank details coming soon.' : 'ព័ត៌មានធនាគារនឹងមកដល់ក្នុងពេលឆាប់ៗនេះ។'}
            </p>
          )}
        </div>
      </div>
    </div>

    <!-- Info text -->
    <div class="mt-20 pt-10 border-t border-bamboo-800 text-center max-w-3xl mx-auto space-y-4">
      <p class="text-bamboo-100 font-medium">
        {locale === 'de' 
          ? 'Gefördert durch den deutschen Verein „Bamboo Shoots e.V."'
          : locale === 'en' 
          ? 'Supported by the German association "Bamboo Shoots e.V."'
          : 'គាំទ្រដោយសមាគមអាល្លឺម៉ង់ "Bamboo Shoots e.V."'}
      </p>
      <p class="text-bamboo-400 text-sm leading-relaxed">
        {locale === 'de' 
          ? 'Der Förderverein wird ehrenamtlich geführt. Ihre Spenden fließen direkt in die Projektarbeit vor Ort.'
          : locale === 'en' 
          ? 'The support association is run on a volunteer basis. Your donations go directly to project work on site.'
          : 'សមាគមគាំទ្រត្រូវបានដំណើរការដោយស្ម័គ្រចិត្ត។'}
      </p>
    </div>
  </div>
</section>
