---
import { t, type Locale } from '../../lib/i18n';
import SanityImage from '../SanityImage.astro';
import BambooVisual from '../BambooVisual.astro';

interface Props {
  locale: Locale;
  programs: any[];
  intro: any;
  title: any;
}

const { locale, programs, intro, title } = Astro.props;

// Icons mapping for fallback/placeholders
const getIcon = (iconName: string) => {
  switch (iconName) {
    case 'babies': case 'preschool':
      return `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 10a4 4 0 1 0 0-8 4 4 0 0 0 0 8Z"/><path d="M2 21a10 10 0 0 1 20 0"/></svg>`;
    case 'education': case 'afternoon':
      return `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4z"/></svg>`;
    case 'library':
      return `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20"/><path d="M6.5 2H20v20H6.5A2.5 2.5 0 0 1 4 19.5v-15A2.5 2.5 0 0 1 6.5 2z"/></svg>`;
    case 'community':
      return `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>`;
    default:
      return `<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>`;
  }
};

const defaultPrograms = [
  {
    icon: 'preschool',
    title: { de: 'Vorschule & Bildung', en: 'Preschool & Education', kh: 'មត្តេយ្យ និងការអប់រំ' },
    description: { 
      de: 'Frühförderung ist der erste Schritt in eine bessere Zukunft. Wir betreiben Vorschulen in abgelegenen Dörfern rund um Siem Reap. Dort werden Kinder zwischen drei und fünf Jahren spielerisch auf die Schule vorbereitet.',
      en: 'Early childhood education is the first step to a better future. We operate preschools in remote villages around Siem Reap.',
      kh: 'ការអប់រំកុមារភាពដំបូងគឺជាជំហានដំបូងទៅកាន់អនាគតល្អប្រសើរ។'
    },
    features: [
      { de: 'Altersgerechter Unterricht', en: 'Age-appropriate teaching' },
      { de: 'Hygienische Erziehung', en: 'Hygiene education' },
      { de: 'Täglich warme Mahlzeit', en: 'Daily warm meal' }
    ]
  },
  {
    icon: 'afternoon',
    title: { de: 'Nachmittagsförderung', en: 'Afternoon Support', kh: 'ការគាំទ្រពេលរសៀល' },
    description: {
      de: 'Für Schulkinder bieten wir Nachmittagskurse in Khmer, Englisch und Mathematik an – für viele Kinder die einzige Möglichkeit, eine Fremdsprache zu lernen.',
      en: 'For school children we offer afternoon courses in Khmer, English and Mathematics – for many children the only opportunity to learn a foreign language.',
      kh: 'សម្រាប់កុមារសាលា យើងផ្តល់វគ្គសិក្សាពេលរសៀលជាភាសាខ្មែរ អង់គ្លេស និងគណិតវិទ្យា។'
    },
    features: [
      { de: 'Kambodschanische Lehrer:innen', en: 'Cambodian teachers' },
      { de: 'Individuell und motivierend', en: 'Individual and motivating' }
    ]
  },
  {
    icon: 'library',
    title: { de: 'Bibliothek', en: 'Library', kh: 'បណ្ណាល័យ' },
    description: {
      de: 'Die Bibliothek ist mehr als ein Lernort: Sie ist ein Treffpunkt, Leseraum und ein sicherer Ort zum Wachsen.',
      en: 'The library is more than a learning place: It is a meeting point, reading room and a safe space to grow.',
      kh: 'បណ្ណាល័យគឺច្រើនជាងកន្លែងរៀន៖ វាជាចំណុចជួបជុំ បន្ទប់អាន និងកន្លែងសុវត្ថិភាពដើម្បីរីកចម្រើន។'
    },
    features: [
      { de: 'Leihbücher für alle Altersgruppen', en: 'Books for all ages' },
      { de: 'Kreative Förderung', en: 'Creative activities' }
    ]
  },
  {
    icon: 'community',
    title: { de: 'Hilfe für die Gemeinschaft', en: 'Community Support', kh: 'ការគាំទ្រសហគមន៍' },
    description: {
      de: 'Wir unterstützen die Familien auch in Notsituationen. Hilfe zur Selbsthilfe durch Reis- und Hygienepakete sowie individuelle Beratung.',
      en: 'We also support families in emergency situations. Help for self-help through rice and hygiene packages and individual counseling.',
      kh: 'យើងក៏គាំទ្រគ្រួសារក្នុងស្ថានភាពបន្ទាន់។'
    },
    features: [
      { de: 'Reis- und Hygienepakete', en: 'Rice and hygiene packages' },
      { de: 'Hausbesuche & Beratung', en: 'Home visits & consultation' }
    ]
  }
];

const displayPrograms = programs?.length > 0 ? programs : defaultPrograms;
---

<section id="programme" class="py-16 md:py-48 bg-branding-accent relative">
  <!-- Bamboo Animation (Absolute background) -->
  <div class="hidden lg:block absolute left-4 top-0 bottom-0 w-[200px] pointer-events-none z-10">
    <BambooVisual />
  </div>

  <div class="container-custom relative z-20 lg:pl-[160px]">
    <!-- Section Header -->
    <!-- Section Header -->
    <div class="max-w-4xl mb-16 md:mb-32 reveal border-l-[3px] border-primary/20 pl-6 md:pl-16">

      <h3 class="text-4xl md:text-6xl font-heading font-extrabold text-branding-dark mb-10 tracking-tighter">
        {t(title, locale) || (locale === 'de' ? 'Unsere Arbeit' : locale === 'en' ? 'Our Programs' : 'កម្មវិធីរបស់យើង')}
      </h3>
      <p class="text-branding-muted text-lg md:text-2xl font-light leading-relaxed max-w-2xl">
        {t(intro, locale) || (locale === 'de' 
          ? 'Wir unterstützen Kinder und Familien durch gezielte Bildungsprojekte und soziale Arbeit.' 
          : locale === 'en'
          ? 'We support children and families through targeted education projects and social work.'
          : 'យើងគាំទ្រកុមារ និងគ្រួសារតាមរយៈគម្រោងអប់រំ និងការងារសង្គម។')}
      </p>
    </div>

    <!-- Side-by-Side Portfolio Layout -->
    <div class="space-y-16 md:space-y-48">
      {displayPrograms.map((program, index) => (
        <div class={`flex flex-col lg:flex-row items-center gap-12 md:gap-24 ${index % 2 !== 0 ? 'lg:flex-row-reverse' : ''}`}>
          <!-- Image Side -->
          <div class="w-full lg:w-1/2 reveal">
            <div class="relative group">
              <div class="aspect-[4/3] rounded-[2rem] md:rounded-[2.5rem] overflow-hidden shadow-2xl bg-white">
                {program.image ? (
                  <SanityImage 
                    src={program.image} 
                    alt={t(program.title, locale)}
                    class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000"
                    width={600}
                    aspectRatio={4/3}
                    widths={[300, 600, 900, 1200]}
                    sizes="(max-width: 1024px) 100vw, 500px"
                  />
                ) : (
                  <div class="w-full h-full bg-branding-accent flex items-center justify-center text-primary/20">
                    <div class="w-24 h-24" set:html={getIcon(program.icon || 'default')}></div>
                  </div>
                )}
                <!-- Overlay accent -->
                <div class="absolute inset-0 bg-primary/5 group-hover:bg-transparent transition-colors duration-500"></div>
              </div>
              <!-- Number Indicator -->
              <div class="absolute -bottom-6 -right-6 md:-bottom-10 md:-right-10 w-20 h-20 md:w-32 md:h-32 bg-white rounded-full flex items-center justify-center shadow-xl z-20 font-heading font-extrabold text-secondary/40 text-2xl md:text-4xl italic transition-transform group-hover:scale-110 duration-500">
                0{index + 1}
              </div>
            </div>
          </div>

          <!-- Content Side -->
          <div class="w-full lg:w-1/2 reveal">
             <div class="max-w-xl mx-auto lg:mx-0">
                <h4 class="text-3xl md:text-4xl font-heading font-extrabold text-branding-dark mb-8 tracking-tight">
                  {t(program.title, locale)}
                </h4>
                
                <p class="text-lg md:text-xl text-branding-muted leading-relaxed font-light mb-10">
                  {t(program.description, locale)}
                </p>

                {program.features && (
                  <ul class="space-y-4 border-l-2 border-primary/10 pl-8">
                    {program.features.map((feature: any) => (
                      <li class="flex items-start gap-4 group/item">
                        <div class="w-1.5 h-1.5 rounded-full bg-secondary mt-2.5 shrink-0 group-hover/item:scale-150 transition-transform duration-300"></div>
                        <span class="text-branding-muted font-medium">
                          {typeof feature === 'string' ? feature : t(feature, locale)}
                        </span>
                      </li>
                    ))}
                  </ul>
                )}
             </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>
