---
import { t, type Locale } from '../../lib/i18n';
import { urlFor } from '../../lib/sanity';

interface Props {
  locale: Locale;
  programs: any[];
}

const { locale, programs } = Astro.props;

// Default programs if none from Sanity
const defaultPrograms = [
  {
    icon: 'preschool',
    title: { de: 'Vorschule & Bildung', en: 'Preschool & Education', kh: 'មត្តេយ្យ និងការអប់រំ' },
    description: { 
      de: 'Frühförderung ist der erste Schritt in eine bessere Zukunft. Wir betreiben Vorschulen in abgelegenen Dörfern rund um Siem Reap.',
      en: 'Early childhood education is the first step to a better future. We operate preschools in remote villages around Siem Reap.',
      kh: 'ការអប់រំកុមារភាពដំបូងគឺជាជំហានដំបូងទៅកាន់អនាគតល្អប្រសើរ។'
    },
    features: [
      { de: 'Altersgerechter Unterricht', en: 'Age-appropriate teaching', kh: 'ការបង្រៀនសមស្របតាមអាយុ' },
      { de: 'Hygienische Erziehung', en: 'Hygiene education', kh: 'ការអប់រំអនាម័យ' },
      { de: 'Täglich warme Mahlzeit', en: 'Daily warm meal', kh: 'អាហារក្តៅប្រចាំថ្ងៃ' },
      { de: 'Integration aller Kinder', en: 'Inclusion of all children', kh: 'ការដាក់បញ្ចូលកុមារទាំងអស់' }
    ]
  },
  {
    icon: 'afternoon',
    title: { de: 'Nachmittagsförderung', en: 'Afternoon Support', kh: 'ការគាំទ្រពេលរសៀល' },
    description: {
      de: 'Für Schulkinder bieten wir Nachmittagskurse in Khmer, Englisch und Mathematik an – für viele Kinder die einzige Möglichkeit, eine Fremdsprache zu lernen.',
      en: 'For school children we offer afternoon courses in Khmer, English and Mathematics – for many children the only opportunity to learn a foreign language.',
      kh: 'សម្រាប់កុមារសាលា យើងផ្តល់វគ្គសិក្សាពេលរសៀលជាភាសាខ្មែរ អង់គ្លេស និងគណិតវិទ្យា។'
    },
    features: [
      { de: 'Kinder 6–17 Jahre', en: 'Children aged 6–17', kh: 'កុមារអាយុ 6-17 ឆ្នាំ' },
      { de: 'Kambodschanische Lehrer:innen', en: 'Cambodian teachers', kh: 'គ្រូបង្រៀនកម្ពុជា' },
      { de: 'Individuell und motivierend', en: 'Individual and motivating', kh: 'បុគ្គល និងលើកទឹកចិត្ត' }
    ]
  },
  {
    icon: 'library',
    title: { de: 'Bibliothek', en: 'Library', kh: 'បណ្ណាល័យ' },
    description: {
      de: 'Die Bibliothek ist mehr als ein Lernort: Sie ist ein Treffpunkt, Leseraum und ein sicherer Ort zum Wachsen.',
      en: 'The library is more than a learning place: It is a meeting point, reading room and a safe space to grow.',
      kh: 'បណ្ណាល័យគឺច្រើនជាងកន្លែងរៀន៖ វាជាចំណុចជួបជុំ បន្ទប់អាន និងកន្លែងសុវត្ថិភាពដើម្បីរីកចម្រើន។'
    },
    features: [
      { de: 'Leihbücher für alle Altersgruppen', en: 'Books for all ages', kh: 'សៀវភៅសម្រាប់គ្រប់អាយុ' },
      { de: 'Kreative Förderung durch Basteln', en: 'Creative activities', kh: 'សកម្មភាពច្នៃប្រឌិត' },
      { de: 'Themenreihen: Hygiene, Umgang mit Geld', en: 'Themed series: Hygiene, money management', kh: 'ស៊េរីប្រធានបទ' }
    ]
  },
  {
    icon: 'community',
    title: { de: 'Hilfe für die Gemeinschaft', en: 'Community Support', kh: 'ការគាំទ្រសហគមន៍' },
    description: {
      de: 'Wir unterstützen die Familien auch in Notsituationen. Hilfe zur Selbsthilfe.',
      en: 'We also support families in emergency situations. Help for self-help.',
      kh: 'យើងក៏គាំទ្រគ្រួសារក្នុងស្ថានភាពបន្ទាន់។'
    },
    features: [
      { de: 'Moskitonetze & Fahrräder', en: 'Mosquito nets & bicycles', kh: 'មុងគ្រែបាញ់ និងកង់' },
      { de: 'Reis- und Hygienepakete', en: 'Rice and hygiene packages', kh: 'កញ្ចប់អង្ករ និងអនាម័យ' },
      { de: 'Hausbesuche & Beratung', en: 'Home visits & consultation', kh: 'ទស្សនាផ្ទះ និងពិគ្រោះយោបល់' },
      { de: 'Bildung für Erwachsene', en: 'Adult education', kh: 'ការអប់រំមនុស្សពេញវ័យ' }
    ]
  }
];

const displayPrograms = programs?.length > 0 ? programs : defaultPrograms;

const getIcon = (key: string) => {
  switch(key) {
    case 'baby': case 'preschool': return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M12 22c5.523 0 10-4.477 10-10S17.523 2 12 2 2 6.477 2 12s4.477 10 10 10zM12 6v12M6 12h12"/></svg>';
    case 'book': case 'afternoon': return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20M4 19.5A2.5 2.5 0 0 0 6.5 22H20M4 19.5V5A2.5 2.5 0 0 1 6.5 2.5H20v14.5"/></svg>';
    case 'library': return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M22 17H2M2 22h20M7 17V3M17 17V3M2 3h20"/></svg>';
    case 'community': return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>';
    default: return '<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="12" cy="12" r="10"/><path d="m9 12 2 2 4-4"/></svg>';
  }
};
---

<section id="programme" class="section bg-branding-accent relative overflow-hidden">
  <div class="container-custom relative z-10">
    <!-- Section header -->
    <div class="reveal mb-20 border-l-2 border-primary/30 pl-8 md:pl-12">
        <h2 class="text-xs md:text-sm uppercase tracking-[0.4em] font-bold text-primary mb-6 opacity-60">
            {locale === 'de' ? 'Unsere Arbeit' : 'Our Work'}
        </h2>
        <p class="text-4xl md:text-6xl font-heading font-extrabold text-branding-dark tracking-tighter">
            {locale === 'de' ? 'Unsere Programme' : locale === 'en' ? 'Our Programs' : 'កម្មវិធីរបស់យើង'}
        </p>
    </div>

    <!-- Program cards -->
    <div class="grid grid-cols-1 md:grid-cols-2 gap-8 lg:gap-12">
      {displayPrograms.map((program, index) => (
        <div class={`reveal reveal-delay-${(index % 2) * 200} group flex flex-col h-full bg-white rounded-[2.5rem] overflow-hidden border border-black/5 hover:shadow-2xl transition-all duration-700`}>
          <!-- Image Header -->
          <div class="aspect-[16/10] overflow-hidden relative hover-zoom-container">
            {program.image ? (
              <img 
                src={urlFor(program.image).width(800).height(500).url()} 
                alt={t(program.title, locale)}
                class="w-full h-full object-cover"
              />
            ) : (
              <div class="w-full h-full bg-branding-dark/5 flex items-center justify-center">
                 <div class="w-24 h-24 text-primary/20 group-hover:text-primary/40 transition-colors duration-500" set:html={getIcon(program.icon)} />
              </div>
            )}
            <!-- Overlay Gradient -->
            <div class="absolute inset-0 bg-[linear-gradient(to_top,rgba(0,0,0,0.4)_0%,transparent_50%)] opacity-0 group-hover:opacity-100 transition-opacity duration-500"></div>
          </div>

          <div class="p-8 md:p-12 flex flex-col flex-grow">
            <!-- Title Row -->
            <div class="flex items-start justify-between mb-8">
              <div class="flex-grow">
                 <h3 class="text-2xl md:text-3xl font-heading font-extrabold text-branding-dark leading-tight tracking-tight group-hover:text-primary transition-colors duration-300">
                    {t(program.title, locale)}
                  </h3>
              </div>
              <div class="w-10 h-10 text-secondary opacity-40 group-hover:opacity-100 group-hover:scale-110 transition-all duration-500 flex-shrink-0 ml-4" set:html={getIcon(program.icon)} />
            </div>

            <!-- Description -->
            <p class="text-branding-muted text-lg mb-10 leading-relaxed font-light">
              {t(program.description, locale)}
            </p>

            <!-- Features list -->
            {program.features && (
              <ul class="space-y-4 mb-8">
                {program.features.map((feature: any) => (
                  <li class="flex items-center gap-4 text-branding-text group/item">
                    <div class="flex-shrink-0 w-1.5 h-1.5 rounded-full bg-secondary group-hover/item:scale-150 transition-transform duration-300"></div>
                    <span class="text-sm font-medium tracking-wide ">{t(feature, locale)}</span>
                  </li>
                ))}
              </ul>
            )}
            
            <div class="mt-auto pt-4 border-t border-black/5 flex justify-end">
                 <div class="w-8 h-px bg-primary/20 group-hover:w-16 transition-all duration-500"></div>
            </div>
          </div>
        </div>
      ))}
    </div>
  </div>
</section>
