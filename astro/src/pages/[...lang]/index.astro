---
import Layout from "../../layouts/Layout.astro";
import Hero from "../../components/sections/Hero.astro";
import Purpose from "../../components/sections/Purpose.astro";
import Programs from "../../components/sections/Programs.astro";
import Team from "../../components/sections/Team.astro";
import CambodiaTeaser from "../../components/sections/CambodiaTeaser.astro";
import Donate from "../../components/sections/Donate.astro";
import Visit from "../../components/sections/Visit.astro";
import Gallery from "../../components/sections/Gallery.astro";

import { getLocale, t, locales, defaultLocale } from "../../lib/i18n";
import {
  getHomePage,
  getTeamMembers,
  getDonationTiers,
  getSiteSettings,
} from "../../lib/sanity";

export async function getStaticPaths() {
  return [
    { params: { lang: undefined } },
    { params: { lang: "en" } },
    { params: { lang: "kh" } },
  ];
}

const { lang } = Astro.params;
const locale = (lang as any) || defaultLocale;

const homePage = await getHomePage();
const teamMembers = await getTeamMembers();
const donationTiers = await getDonationTiers();
const settings = await getSiteSettings();

const pageTitle =
  t(homePage?.seo?.metaTitle, locale) || t(homePage?.pageTitle, locale) || "";
---

<Layout title={pageTitle} locale={locale} seo={homePage?.seo}>
  <Hero locale={locale} data={homePage?.hero} settings={settings} />
  <Purpose
    locale={locale}
    welcomeData={homePage?.welcome}
    missionData={homePage?.mission}
  />
  <CambodiaTeaser locale={locale} data={homePage?.cambodiaTeaser} />
  <Programs
    locale={locale}
    programs={homePage?.programs}
    intro={homePage?.programsIntro}
    title={homePage?.programsTitle}
  />
  <Team locale={locale} members={teamMembers} data={homePage?.team} />
  <Donate locale={locale} tiers={donationTiers} settings={settings} />
  <Visit locale={locale} data={homePage?.visit} />
</Layout>
