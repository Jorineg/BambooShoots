---
import Layout from "../../layouts/Layout.astro";
import { getLocale, t, localizedUrl, defaultLocale } from "../../lib/i18n";
import { getHistoryPage, getTimelineEvents } from "../../lib/sanity";

export async function getStaticPaths() {
  return [
    { params: { lang: undefined } },
    { params: { lang: "en" } },
    { params: { lang: "kh" } },
  ];
}

const { lang } = Astro.params;
const locale = (lang as any) || defaultLocale;

const historyPage = await getHistoryPage();
const timelineEvents = await getTimelineEvents();

const pageTitle =
  locale === "de" ? "Geschichte" : locale === "en" ? "History" : "ប្រវត្តិ";

// Default timeline events
const defaultEvents = [
  {
    year: "2003",
    title: {
      de: "Erste Vorschule & Kids Club in Kok Kryll",
      en: "First preschool & kids club in Kok Kryll",
      kh: "មត្តេយ្យដំបូង និងក្លិបកុមារនៅ Kok Kryll",
    },
  },
  {
    year: "2005",
    title: {
      de: "Ausbau & Erweiterung: Weiterer Standort Liang Dai",
      en: "Expansion: Additional location Liang Dai",
      kh: "ពង្រីក៖ ទីតាំងបន្ថែម Liang Dai",
    },
  },
  {
    year: "2006",
    title: {
      de: "Offizielle NGO-Gründung Bamboo Shoots – Time to Grow",
      en: "Official NGO founding of Bamboo Shoots",
      kh: "ការបង្កើតផ្លូវការរបស់ Bamboo Shoots",
    },
  },
  {
    year: "2008",
    title: {
      de: "Bibliothek eröffnet in Phum Prasat",
      en: "Library opens in Phum Prasat",
      kh: "បណ្ណាល័យបើកនៅ Phum Prasat",
    },
  },
  {
    year: "2009",
    title: {
      de: "3. Vorschule gebaut in Rokar Yea",
      en: "3rd preschool built in Rokar Yea",
      kh: "មត្តេយ្យទី 3 សាងសង់នៅ Rokar Yea",
    },
  },
  {
    year: locale === "de" ? "Heute" : locale === "en" ? "Today" : "ថ្ងៃនេះ",
    title: {
      de: "Mehr als 250 Kinder werden regelmäßig betreut",
      en: "More than 250 children are regularly cared for",
      kh: "កុមារជាង 250 នាក់ត្រូវបានថែរក្សាជាទៀងទាត់",
    },
  },
];

const displayEvents =
  timelineEvents?.length > 0 ? timelineEvents : defaultEvents;

const pageSubtitle =
  t(historyPage?.intro, locale) ||
  (locale === "de"
    ? "Vom Schatten der Vergangenheit zum Mut der nächsten Generation. Erfahren Sie mehr über den Weg Kambodschas und die Wurzeln von Bamboo Shoots."
    : locale === "en"
      ? "From the shadows of the past to the courage of the next generation. Learn more about Cambodia's path and the roots of Bamboo Shoots."
      : "ពីស្រមោលអតីតកាលទៅនឹងភាពក្លាហានរបស់មនុស្សជំនាន់ក្រោយ។ ស្វែងយល់បន្ថែមអំពីផ្លូវរបស់កម្ពុជា និងប្រភពដើមនៃ Bamboo Shoots ។");
---

<Layout title={pageTitle} locale={locale}>
  <!-- Hero -->
  <section
    class="pt-32 pb-24 md:pt-48 md:pb-32 bg-branding-bg relative overflow-hidden"
  >
    <!-- Subtle Ambient Glow -->
    <div
      class="absolute top-0 right-0 w-[500px] h-[500px] bg-primary/5 rounded-full blur-[120px] -mr-64 -mt-64 pointer-events-none"
    >
    </div>

    <div class="container-custom px-4 md:px-8 relative z-10">
      <div
        class="max-w-4xl border-l-[3px] border-primary/20 pl-8 md:pl-16 reveal"
      >
        <h1
          class="text-4xl md:text-6xl lg:text-7xl font-heading font-extrabold text-branding-dark mb-10 tracking-tighter leading-[1.1] max-w-4xl"
        >
          {
            t(historyPage?.pageTitle, locale) ||
              (locale === "de"
                ? "Kambodscha – Ein Land mit Vergangenheit und Zukunft"
                : locale === "en"
                  ? "Cambodia – A Country with Past and Future"
                  : "កម្ពុជា – ប្រទេសមួយដែលមានអតីតកាល និងអនាគត")
          }
        </h1>

        <p
          class="text-branding-muted text-lg md:text-2xl font-light leading-relaxed max-w-2xl"
        >
          {pageSubtitle}
        </p>
      </div>
    </div>
  </section>

  <!-- Geography -->
  <section class="py-24 md:py-32 bg-branding-bg overflow-hidden">
    <div class="container-custom px-4 md:px-8">
      <div
        class="flex flex-col lg:flex-row items-center gap-12 md:gap-24 reveal"
      >
        <div class="w-full lg:w-1/2">
          <h2
            class="text-3xl md:text-5xl font-heading font-extrabold text-branding-dark mb-8 tracking-tighter"
          >
            {
              locale === "de"
                ? "Land & Lage"
                : locale === "en"
                  ? "Location"
                  : "ទីតាំង"
            }
          </h2>
          <p
            class="text-branding-text text-lg md:text-xl leading-relaxed font-light"
          >
            {
              t(historyPage?.cambodiaBackground?.geography, locale) ||
                (locale === "de"
                  ? "Kambodscha liegt im Herzen Südostasiens, eingebettet zwischen Thailand, Laos und Vietnam. Mehr als 17 Millionen Menschen leben heute im Land, davon etwa 2,4 Millionen in der Hauptstadt Phnom Penh."
                  : locale === "en"
                    ? "Cambodia lies in the heart of Southeast Asia, nestled between Thailand, Laos and Vietnam. More than 17 million people live in the country today, about 2.4 million of them in the capital Phnom Penh."
                    : "កម្ពុជាស្ថិតនៅចំកណ្តាលអាស៊ីអាគ្នេយ៍ រវាងថៃ ឡាវ និងវៀតណាម។")
            }
          </p>
        </div>
        <div class="w-full lg:w-1/2">
          <div class="relative group">
            <div
              class="aspect-[4/3] rounded-[2.5rem] overflow-hidden shadow-2xl"
            >
              <img
                src="/images/geography.png"
                alt="Cambodia Landscape"
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- History -->
  <section class="py-24 md:py-32 bg-branding-bg overflow-hidden">
    <div class="container-custom px-4 md:px-8">
      <div
        class="flex flex-col lg:flex-row-reverse items-center gap-12 md:gap-24 reveal"
      >
        <div class="w-full lg:w-1/2">
          <h2
            class="text-3xl md:text-5xl font-heading font-extrabold text-branding-dark mb-8 tracking-tighter"
          >
            {
              locale === "de"
                ? "Schwere Geschichte"
                : locale === "en"
                  ? "Difficult History"
                  : "ប្រវត្តិសាស្រ្តលំបាក"
            }
          </h2>
          <div class="space-y-6">
            <p
              class="text-branding-text text-lg md:text-xl leading-relaxed font-light"
            >
              {
                t(historyPage?.cambodiaBackground?.history, locale) ||
                  (locale === "de"
                    ? "Die Narben der Vergangenheit sind in Kambodscha bis heute spürbar. Zwischen 1975 und 1979 herrschte das Terrorregime der Roten Khmer unter Pol Pot."
                    : locale === "en"
                      ? "The scars of the past are still visible in Cambodia today. Between 1975 and 1979, the terror regime of the Khmer Rouge under Pol Pot ruled."
                      : "ស្នាមរបួសអតីតកាលនៅតែមើលឃើញនៅកម្ពុជាថ្ងៃនេះ។")
              }
            </p>
            <p
              class="text-branding-text text-lg md:text-xl leading-relaxed font-light"
            >
              {
                locale === "de"
                  ? "Schulen und Krankenhäuser wurden zerstört, große Teile der gebildeten Bevölkerung ausgelöscht. Auch heute noch sind viele Landregionen von den Folgen dieser Zeit geprägt."
                  : locale === "en"
                    ? "Schools and hospitals were destroyed, large parts of the educated population were wiped out. Many rural areas are still affected by the consequences of this period today."
                    : "សាលារៀន និងមន្ទីរពេទ្យត្រូវបានបំផ្លាញ។"
              }
            </p>
          </div>
        </div>
        <div class="w-full lg:w-1/2">
          <div class="relative group">
            <div
              class="aspect-[4/3] rounded-[2.5rem] overflow-hidden shadow-2xl"
            >
              <img
                src="/images/history_war.png"
                alt="Angkor Wat History"
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Economy -->
  <section
    class="py-24 md:py-32 bg-branding-bg overflow-hidden border-b border-black/5"
  >
    <div class="container-custom px-4 md:px-8">
      <div
        class="flex flex-col lg:flex-row items-center gap-12 md:gap-24 reveal"
      >
        <div class="w-full lg:w-1/2">
          <h2
            class="text-3xl md:text-5xl font-heading font-extrabold text-branding-dark mb-8 tracking-tighter"
          >
            {
              locale === "de"
                ? "Aufbruch & Armut"
                : locale === "en"
                  ? "Progress & Poverty"
                  : "រវាងវឌ្ឍនភាព និងភាពក្រីក្រ"
            }
          </h2>
          <p
            class="text-branding-text text-lg md:text-xl leading-relaxed font-light"
          >
            {
              t(historyPage?.cambodiaBackground?.economy, locale) ||
                (locale === "de"
                  ? "In den letzten zwei Jahrzehnten hat Kambodscha wirtschaftlich aufgeholt – vor allem durch Textilien, Bauwirtschaft und Tourismus zum weltberühmten Angkor Wat. Doch die Herausforderungen bleiben groß."
                  : locale === "en"
                    ? "In the last two decades, Cambodia has caught up economically – mainly through textiles, construction and tourism to the world-famous Angkor Wat. But the challenges remain great."
                    : "ក្នុងរយៈពេលពីរទសវត្សរ៍កន្លងមក កម្ពុជាបានរីកចម្រើនផ្នែកសេដ្ឋកិច្ច។")
            }
          </p>
        </div>
        <div class="w-full lg:w-1/2">
          <div class="relative group">
            <div
              class="aspect-[4/3] rounded-[2.5rem] overflow-hidden shadow-2xl"
            >
              <img
                src="/images/economy.png"
                alt="Siem Reap Street"
                class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-1000"
              />
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Education Highlight Section -->
  <section class="py-32 md:py-48 bg-branding-accent relative overflow-hidden">
    <!-- Background Decor -->
    <div class="absolute inset-0 z-0 opacity-10">
      <div
        class="absolute top-0 left-0 w-full h-full bg-[radial-gradient(circle_at_30%_50%,rgba(var(--color-primary),0.1),transparent)]"
      >
      </div>
    </div>

    <div class="container-custom px-4 md:px-8 relative z-10">
      <div
        class="flex flex-col lg:flex-row items-center gap-16 md:gap-24 reveal"
      >
        <!-- Text Content -->
        <div class="w-full lg:w-1/2 order-2 lg:order-1">
          <h2
            class="text-4xl md:text-6xl font-heading font-extrabold text-branding-dark mb-10 tracking-tighter leading-tight"
          >
            {
              locale === "de"
                ? "Bildung ist keine Selbstverständlichkeit"
                : locale === "en"
                  ? "Education is Not a Given"
                  : "ការអប់រំមិនមែនជារឿងធម្មតាទេ"
            }
          </h2>

          <div class="space-y-8">
            <p
              class="text-xl md:text-2xl text-branding-dark/80 font-light leading-relaxed"
            >
              {
                t(historyPage?.cambodiaBackground?.education, locale) ||
                  (locale === "de"
                    ? "Obwohl Kambodscha ein staatliches Bildungssystem anbietet, ist Bildung gerade auf dem Land für viele Kinder nicht erreichbar oder nicht finanzierbar."
                    : locale === "en"
                      ? "Although Cambodia offers a public education system, education is often not accessible or affordable for many children, especially in rural areas."
                      : "ទោះបីជាកម្ពុជាផ្តល់ប្រព័ន្ធអប់រំសាធារណៈ ការអប់រំជារឿយៗមិនអាចទទួលបានសម្រាប់កុមារជាច្រើន។")
              }
            </p>

            <ul class="space-y-6 py-6 border-y border-black/5">
              {
                [
                  {
                    de: "Viele Kinder müssen früh zum Lebensunterhalt beitragen",
                    en: "Many children contribute to family income early",
                    kh: "កុមារជាច្រើនត្រូវរួមចំណែកក្នុងប្រាក់ចំណូលគ្រួសារ",
                  },
                  {
                    de: "Oder auf kleinere Geschwister aufpassen",
                    en: "Or look after younger siblings",
                    kh: "ឬមើលថែប្អូនៗ",
                  },
                  {
                    de: "Lange Schulwege ohne Transportmittel",
                    en: "Long school routes without transportation",
                    kh: "ផ្លូវទៅសាលារៀនវែងដោយគ្មានការដឹកជញ្ជូន",
                  },
                ].map((item) => (
                  <li class="flex items-center gap-6 group">
                    <div class="w-2 h-2 rounded-full bg-secondary group-hover:scale-150 transition-transform duration-300" />
                    <span class="text-lg md:text-xl text-branding-dark/70 font-medium">
                      {item[locale as keyof typeof item] || item.de}
                    </span>
                  </li>
                ))
              }
            </ul>

            <div
              class="p-8 bg-white/60 backdrop-blur-xl rounded-3xl border border-white/40 shadow-xl shadow-black/5"
            >
              <p
                class="text-branding-dark text-lg md:text-xl font-bold italic leading-relaxed"
              >
                {
                  locale === "de"
                    ? "Besonders betroffen sind die Dörfer rund um Siem Reap – dort leben über 50% der Bevölkerung unter der Armutsgrenze von rund 2$ am Tag."
                    : locale === "en"
                      ? "Villages around Siem Reap are particularly affected – over 50% of the population there lives below the poverty line."
                      : "ភូមិជុំវិញសៀមរាបត្រូវបានប៉ះពាល់ជាពិសេស – ប្រជាជនជាង 50% រស់នៅក្រោមបន្ទាត់ភាពក្រីក្រ។"
                }
              </p>
            </div>
          </div>
        </div>

        <!-- Image Cluster -->
        <div class="w-full lg:w-1/2 order-1 lg:order-2">
          <div class="relative">
            <div
              class="aspect-square md:aspect-[4/5] rounded-[3rem] overflow-hidden shadow-2xl relative z-10 border-[12px] border-white"
            >
              <img
                src="/images/education.png"
                alt="Cambodian school children"
                class="w-full h-full object-cover"
              />
            </div>
            <!-- Decorative Elements -->
            <div
              class="absolute -top-8 -right-8 w-64 h-64 bg-primary/20 rounded-full blur-3xl -z-10"
            >
            </div>
            <div
              class="absolute -bottom-8 -left-8 w-64 h-64 bg-secondary/20 rounded-full blur-3xl -z-10"
            >
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>

  <!-- Bamboo Shoots Timeline -->
  <section class="section bg-branding-accent relative overflow-hidden">
    <div class="container-custom px-4 md:px-8">
      <div class="max-w-4xl mx-auto">
        <div class="mb-24 md:mb-32 reveal">
          <h2
            class="text-4xl md:text-6xl font-heading font-extrabold text-branding-dark mb-10 tracking-tighter"
          >
            {
              locale === "de"
                ? "Unsere Geschichte"
                : locale === "en"
                  ? "Our History"
                  : "ប្រវត្តិរបស់យើង"
            }
          </h2>
          <p
            class="text-branding-muted text-lg md:text-2xl font-light leading-relaxed max-w-2xl"
          >
            {
              locale === "de"
                ? "Bamboo Shoots – Eine wachsende Vision seit 2003"
                : locale === "en"
                  ? "Bamboo Shoots – A growing vision since 2003"
                  : "Bamboo Shoots – ចក្ខុវិស័យដែលកំពុងរីកចម្រើនចាប់តាំងពីឆ្នាំ 2003"
            }
          </p>
        </div>

        <!-- Timeline -->
        <div class="relative space-y-12 mb-24">
          {
            displayEvents.map((event, index) => (
              <div
                class="timeline-item reveal"
                style={`transition-delay: ${index * 100}ms`}
              >
                <div class="timeline-dot" />
                <div class="bg-branding-bg rounded-[2rem] p-8 md:p-10 shadow-sm border border-black/5 hover-lift transition-all duration-500">
                  <span class="inline-block bg-primary/10 text-primary font-bold px-4 py-1.5 rounded-full text-xs uppercase tracking-widest mb-6">
                    {event.year}
                  </span>
                  <h3 class="text-xl md:text-2xl font-heading font-extrabold text-branding-dark tracking-tight">
                    {t(event.title, locale)}
                  </h3>
                  {event.description && (
                    <p class="text-branding-muted mt-4 text-lg font-light leading-relaxed">
                      {t(event.description, locale)}
                    </p>
                  )}
                </div>
              </div>
            ))
          }
        </div>

        <!-- Back to home -->
        <div class="text-center reveal">
          <a
            href={localizedUrl("/", locale)}
            class="group inline-flex items-center gap-4 text-branding-dark font-extrabold hover:text-primary transition-all duration-500"
          >
            <div
              class="w-12 h-12 rounded-full border border-black/10 flex items-center justify-center group-hover:bg-primary group-hover:border-primary transition-all duration-500"
            >
              <svg
                class="w-5 h-5 group-hover:-translate-x-1 group-hover:text-white transition-all duration-500"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M7 16l-4-4m0 0l4-4m-4 4h18"></path>
              </svg>
            </div>
            <span
              class="text-sm uppercase tracking-[0.3em] border-b border-black/10 group-hover:border-primary transition-all"
            >
              {
                locale === "de"
                  ? "Zur Startseite"
                  : locale === "en"
                    ? "Back to Home"
                    : "ត្រឡប់ទៅទំព័រដើម"
              }
            </span>
          </a>
        </div>
      </div>
    </div>
  </section>
</Layout>
